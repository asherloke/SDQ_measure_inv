---
title: "Data analyses"
output: html_document
date: "2022-12-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Set up

```{r}
library(tidyverse)
library(lavaan)
library(semPlot)
library(semTools)
MCS <- read.csv("MCS.csv")
```


# Data wrangling

## Variable Selection

```{r}
#we start by selecting variables we want (or in this case disselecting variables we don't want)
data <- MCS %>% select(-CNUM00, -Number_CMs_1, -Academic_Qual_Highest_1, -Banded_NETInc_LoneParent_1, -Banded_NETInc_Couple_1, -Total_Income_Couple_2, -Total_Income_LP_2, -Total_Joint_Income_3, -Total_Income_3, -Freq_DistSleep_Wheez_CM_2, -Freq_DisturbedSleep_Wheezing_3, -Freq_DisturbedSleep_Wheezing_4, -Freq_DisturbedSleep_Wheezing_5, -w6_Sleep_school_night, -w6_Wake_school_day, -w6_Sleep_no_school, -w6_Wake_no_school, -w6_how_long_sleep, -w6_how_awake_night, -w7_sleep_qual, -IQ3, -IQ4)
```

## Recoding and Variable Renaming

We then need to insert NAs where they should be and recode the categorical numbers with letters so they make more sense. We also rename the variables here so it is less confusing.

**Ethnicity**

```{r}
#we first deal with ethnicity
data %>% count(Ethnicity_11cat_1) #see original data and what we need to recode
data_eth <- data %>% 
  mutate(ethnicity = na_if(Ethnicity_11cat_1, "-1")) %>%
  mutate(ethnicity = na_if(ethnicity, "-8")) %>%
  mutate(ethnicity = na_if(ethnicity, "-9"))
data_eth %>% count(ethnicity) #see if it worked
#yes it worked

data_eth <- data_eth %>%
  mutate(ethnicity = recode(ethnicity, 
                            "1" = "White",
                            "2" = "Mixed", 
                            "3" = "Indian", 
                            "4" = "Pakistani",
                            "5" = "Bangladeshi",
                            "6" = "Other Asian",
                            "7" = "Black Caribbean",
                            "8" = "Black African", 
                            "9" = "Other Black", 
                            "10" = "Chinese", 
                            "11" = "Other Ethnic Group")) %>% #this is taken from 11cat ethnicity questionnaire
  select(-Ethnicity_11cat_1)

#check that there should be 752 NAs
data_eth %>% count(ethnicity) #yes, it worked.
```

**Sex**

```{r}
#then we deal with sex (there are 2 sex variables so we will deal with them seperately)

#first sex 3
data_eth %>% count(CM_Sex_3) #see original data and what we need to recode
data_sex3 <- data_eth %>% 
  mutate(sex3 = recode(CM_Sex_3, 
                       "1" = "Male",
                       "2" = "Female")) %>% #this is taken from BSEX questionnaire
  select(-CM_Sex_3)

#check that there should be 4008 NAs
data_sex3 %>% count(sex3) #yes, it worked.
```

```{r}
#then sex 4
data_sex3 %>% count(Sex_CM_4) #see original data and what we need to recode
#there is -1. From convention I assume this is -1

data_sex <- data_sex3 %>% 
  mutate(sex4 = na_if(Sex_CM_4, "-1"))
data_sex %>% count(sex4) #see if it worked
#yes it worked

data_sex <- data_sex %>%
  mutate(sex4 = recode(sex4, 
                       "1" = "Male",
                       "2" = "Female")) %>% #this is taken from BSEX questionnaire
  select(-Sex_CM_4)

#check that there should be 6187 NAs
data_sex %>% count(sex4) #yes, it worked.
```

We need to deal with the two repeated sex columns.

```{r}
data_sex_combined <- data_sex %>% 
  unite("Sex_Com", 
        sex3:sex4, 
        sep = "", 
        remove = F, 
        na.rm = T) #create column called Sex_Com, take sex3 and sex4, with no seperation, do not remove columns, ignore NAs

data_sex_combined %>% count(Sex_Com) #see what the values look like

data_sex_final <- data_sex_combined %>%
  mutate(sex_final = recode(Sex_Com, 
                            "Male" = "Male", 
                            "MaleMale" = "Male", 
                            "Female" = "Female", 
                            "FemaleFemale" = "Female", 
                            "FemaleMale" = "FemaleMale")) %>% #recode the combined columns
  mutate(sex_final = na_if(sex_final, "")) %>% #make blanks NAs (they were blank cause I told unite to ignore NAs)
  select(-sex3, -sex4, -Sex_Com)

data_sex_final %>% count(sex_final) #values all correspond
```

**ASD**

ASD diagnoses was measured at waves 3,4, 5 and 6. If they were ever diagnosed with ASD, I want to consider them as ASD.

Before we rename the values and complicate matters, lets first combine all ASD columns.

```{r}
#insert NAs

#wave 3

#first lets view the data
data_sex_final %>% count(Autism_Diagnosis_3)
data_ASD3 <- data_sex_final %>% 
  mutate(ASD3 = na_if(Autism_Diagnosis_3, "-1")) %>%
  mutate(ASD3 = na_if(ASD3, "-8")) %>%
  mutate(ASD3 = na_if(ASD3, "-9"))
data_ASD3 %>% count(ASD3) #see if it worked
#yes it worked

#wave 4

#first lets view the data
data_ASD3 %>% count(Autism_Diagnosis_4)
data_ASD4 <- data_ASD3 %>% 
  mutate(ASD4 = na_if(Autism_Diagnosis_4, "-1")) %>%
  mutate(ASD4 = na_if(ASD4, "-8")) %>%
  mutate(ASD4 = na_if(ASD4, "-9"))
data_ASD4 %>% count(ASD4) #see if it worked
#yes it worked

#wave 5

#first lets view the data
data_ASD4 %>% count(Autism_Diagnosis_5)
data_ASD5 <- data_ASD4 %>% 
  mutate(ASD5 = na_if(Autism_Diagnosis_5, "-1")) %>%
  mutate(ASD5 = na_if(ASD5, "-8")) %>%
  mutate(ASD5 = na_if(ASD5, "-9"))
data_ASD5 %>% count(ASD5) #see if it worked
#yes it worked

#wave 6

#first lets view the data
data_ASD5 %>% count(Autism_Diagnosis_6)
data_ASD6 <- data_ASD5 %>% 
  mutate(ASD6 = na_if(Autism_Diagnosis_6, "-1")) %>%
  mutate(ASD6 = na_if(ASD6, "-8")) %>%
  mutate(ASD6 = na_if(ASD6, "-9"))
data_ASD6 %>% count(ASD6) #see if it worked
#yes it worked

#combine dataframes
data_ASD_combined <- data_ASD6 %>% 
  unite("ASD_Com", 
        ASD3:ASD6, 
        sep = "", 
        remove = F, 
        na.rm = T) #create column called ASD_Com, take ASD3:ASD6, with no seperation, do not remove columns, ignore NAs
```

After combining ASD columns, we can now recode them.

``` {r}
data_ASD_combined %>% count(ASD_Com) #see what the values look like

data_ASD_final <- data_ASD_combined %>%
  mutate(ASD_final = recode(ASD_Com, 
                            "1" = "ASD", 
                            "11" = "ASD", 
                            "111" = "ASD", 
                            "112" = "ASD", 
                            "12" = "ASD", 
                            "121" = "ASD", 
                            "122" = "ASD", 
                            "1221" = "ASD",
                            "1222" = "ASD", 
                            "2" = "Non-ASD", 
                            "21" = "ASD", 
                            "211" = "ASD", 
                            "212" = "ASD", 
                            "22" = "Non-ASD", 
                            "221" = "ASD",
                            "2211" = "ASD", 
                            "2212" = "ASD", 
                            "222" = "Non-ASD", 
                            "2221" = "ASD", 
                            "2222" = "Non-ASD")) %>% #recode the combined columns
  mutate(ASD_final = na_if(ASD_final, "")) %>% #make blanks NAs (they were blank cause I told unite to ignore NAs)
  select(-ASD3, 
         -ASD4, 
         -ASD5, 
         -ASD6, 
         -Autism_Diagnosis_3, 
         -Autism_Diagnosis_4, 
         -Autism_Diagnosis_5, 
         -Autism_Diagnosis_6,
         -ASD_Com)

data_ASD_final %>% count(ASD_final) #values all correspond
```

We don't want NA values in ASD (this is tolerable in sex as it isn't our variable of comparison)

```{r}
data_ASD_final <- data_ASD_final %>% drop_na(ASD_final)
```

## Wave 5 data

Lets look at wave 5.

In wave 5, there are only SDQ scores from parents and teachers. We don't want any missing data.

```{r}
#wave 5 data
data_w5 <- data_ASD_final %>% drop_na(P_w5_SDQ_01:P_w5_SDQ_25, T_w5_SDQ_01:T_w5_SDQ_25)
```

I need to deal with parent report and teacher report separately and create a report column stating who reporting it. To do this I need to create separate dataframes for parent and teacher (with reduced variables). Then we can combine the dataframes into one SDQ wave 5 data and fit it into the main data frame (with the full range of variables).

### Parent Report

**Draw items**

``` {r}
#parent report items
data_w5_parent <- data_w5 %>% 
  select(MCSID, P_w5_SDQ_01:P_w5_SDQ_25) %>% 
  mutate(Q1 = P_w5_SDQ_01,
         Q2 = P_w5_SDQ_02,
         Q3 = P_w5_SDQ_03,
         Q4 = P_w5_SDQ_04,
         Q5 = P_w5_SDQ_05,
         Q6 = P_w5_SDQ_06,
         Q7 = P_w5_SDQ_07,
         Q8 = P_w5_SDQ_08,
         Q9 = P_w5_SDQ_09,
         Q10 = P_w5_SDQ_10,
         Q11 = P_w5_SDQ_11,
         Q12 = P_w5_SDQ_12,
         Q13 = P_w5_SDQ_13,
         Q14 = P_w5_SDQ_14,
         Q15 = P_w5_SDQ_15,
         Q16 = P_w5_SDQ_16,
         Q17 = P_w5_SDQ_17,
         Q18 = P_w5_SDQ_18,
         Q19 = P_w5_SDQ_19,
         Q20 = P_w5_SDQ_20,
         Q21 = P_w5_SDQ_21,
         Q22 = P_w5_SDQ_22,
         Q23 = P_w5_SDQ_23,
         Q24 = P_w5_SDQ_24,
         Q25 = P_w5_SDQ_25,
         report = "parent") %>%
  pivot_longer(c(Q1:Q25), names_to = "item", values_to = "score") %>%
  select(MCSID, item, score, report)
```

**Recoding**

I need to check the values of the SDQ run from 0 to 2 like the how the SDQ works.

``` {r}
#view data
data_w5_parent %>% count(score)

#scores consist of -1, 1, 2, 3, 4. I assume 1 corresponds to 0, 2 corresponds to 1, 3 corresponds to 2, 4 corresponds to NA, -1 corresponds to missing.

#make -1 and 4 into NAs
data_w5_parent <- data_w5_parent %>%
  mutate(score = na_if(score, "-1")) %>%
  mutate(score = na_if(score, "4"))

#check
data_w5_parent %>% count(score)

#now make 1, 2, 3, into 0, 1, 2.
data_w5_parent <- data_w5_parent %>%
  mutate(score = recode(score,
                        "1" = 0,
                        "2" = 1,
                        "3" = 2))

#check
data_w5_parent %>% count(score)
#looks good.
```

**No NAs!**

``` {r}
data_w5_parent <- data_w5_parent %>% 
  pivot_wider(names_from = item, values_from = score) %>% 
  drop_na(Q1:Q25) %>% 
  pivot_longer(Q1:Q25, names_to = "item", values_to = "score")
```

### Teacher Report

**Draw items**

``` {r}
#teacher
data_w5_teacher <- data_w5 %>% 
  select(MCSID, T_w5_SDQ_01:T_w5_SDQ_25) %>% 
  mutate(Q1 = T_w5_SDQ_01,
         Q2 = T_w5_SDQ_02,
         Q3 = T_w5_SDQ_03,
         Q4 = T_w5_SDQ_04,
         Q5 = T_w5_SDQ_05,
         Q6 = T_w5_SDQ_06,
         Q7 = T_w5_SDQ_07,
         Q8 = T_w5_SDQ_08,
         Q9 = T_w5_SDQ_09,
         Q10 = T_w5_SDQ_10,
         Q11 = T_w5_SDQ_11,
         Q12 = T_w5_SDQ_12,
         Q13 = T_w5_SDQ_13,
         Q14 = T_w5_SDQ_14,
         Q15 = T_w5_SDQ_15,
         Q16 = T_w5_SDQ_16,
         Q17 = T_w5_SDQ_17,
         Q18 = T_w5_SDQ_18,
         Q19 = T_w5_SDQ_19,
         Q20 = T_w5_SDQ_20,
         Q21 = T_w5_SDQ_21,
         Q22 = T_w5_SDQ_22,
         Q23 = T_w5_SDQ_23,
         Q24 = T_w5_SDQ_24,
         Q25 = T_w5_SDQ_25,
         report = "teacher") %>%
  pivot_longer(c(Q1:Q25), names_to = "item", values_to = "score") %>%
  select(MCSID, item, score, report)
```

**Recoding**

I need to check the values of the SDQ run from 0 to 2 like the how the SDQ works.

``` {r}
#view data
data_w5_teacher %>% count(score)

#scores consist of -8, 1, 2, 3. I assume 1 corresponds to 0, 2 corresponds to 1, 3 corresponds to 2, and -8 corresponds to dont know or refusal.

#make -8 into NAs
data_w5_teacher <- data_w5_teacher %>%
  mutate(score = na_if(score, "-8"))

#check
data_w5_teacher %>% count(score)

#now make 1, 2, 3, into 0, 1, 2.
data_w5_teacher <- data_w5_teacher %>%
  mutate(score = recode(score,
                        "1" = 0,
                        "2" = 1,
                        "3" = 2))

#check
data_w5_teacher %>% count(score)
#looks good.
```

**No NAs!**

``` {r}
data_w5_teacher <- data_w5_teacher %>% 
  pivot_wider(names_from = item, values_from = score) %>% 
  drop_na(Q1:Q25) %>% 
  pivot_longer(Q1:Q25, names_to = "item", values_to = "score")
```

### Final Data for Wave 5

Now combine this to main dataframe for wave 5.

``` {r}
#join them
w5_parent_teacher <- bind_rows(data_w5_parent, data_w5_teacher)

#join to main dataframe
data_w5_final <- data_w5 %>% 
  inner_join(w5_parent_teacher, by = "MCSID")
```

## Wave 7 data

This is a repeat of the steps done for wave 5.

Lets look at wave 7.

In wave 7, there are only SDQ scores from parents and cohort members (self-report). We don't want any missing data.

```{r}
#wave 5 data
data_w7 <- data_ASD_final %>% drop_na(P_w7_SDQ_01:P_w7_SDQ_25, CM_w7_SDQ_01:CM_w7_SDQ_25)
```

I need to deal with parent report and self-report separately and create a report column stating who reporting it. To do this I need to create separate dataframes for parent and self (with reduced variables). Then we can combine the dataframes into one SDQ wave 5 data and fit it into the main data frame (with the full range of variables).

### Parent Report

**Draw items**

``` {r}
#parent report items
data_w7_parent <- data_w7 %>% 
  select(MCSID, P_w7_SDQ_01:P_w7_SDQ_25) %>% 
  mutate(Q1 = P_w7_SDQ_01,
         Q2 = P_w7_SDQ_02,
         Q3 = P_w7_SDQ_03,
         Q4 = P_w7_SDQ_04,
         Q5 = P_w7_SDQ_05,
         Q6 = P_w7_SDQ_06,
         Q7 = P_w7_SDQ_07,
         Q8 = P_w7_SDQ_08,
         Q9 = P_w7_SDQ_09,
         Q10 = P_w7_SDQ_10,
         Q11 = P_w7_SDQ_11,
         Q12 = P_w7_SDQ_12,
         Q13 = P_w7_SDQ_13,
         Q14 = P_w7_SDQ_14,
         Q15 = P_w7_SDQ_15,
         Q16 = P_w7_SDQ_16,
         Q17 = P_w7_SDQ_17,
         Q18 = P_w7_SDQ_18,
         Q19 = P_w7_SDQ_19,
         Q20 = P_w7_SDQ_20,
         Q21 = P_w7_SDQ_21,
         Q22 = P_w7_SDQ_22,
         Q23 = P_w7_SDQ_23,
         Q24 = P_w7_SDQ_24,
         Q25 = P_w7_SDQ_25,
         report = "parent") %>%
  pivot_longer(c(Q1:Q25), names_to = "item", values_to = "score") %>%
  select(MCSID, item, score, report)
```

**Recoding**

I need to check the values of the SDQ run from 0 to 2 like the how the SDQ works.

``` {r}
#view data
data_w7_parent %>% count(score)

#scores consist of -1, 1, 2, 3, 4. I assume 1 corresponds to 0, 2 corresponds to 1, 3 corresponds to 2, 4 corresponds to NA, -1 corresponds to missing.

#make -1 and 4 into NAs
data_w7_parent <- data_w7_parent %>%
  mutate(score = na_if(score, "-1")) %>%
  mutate(score = na_if(score, "4"))

#check
data_w7_parent %>% count(score)

#now make 1, 2, 3, into 0, 1, 2.
data_w7_parent <- data_w7_parent %>%
  mutate(score = recode(score,
                        "1" = 0,
                        "2" = 1,
                        "3" = 2))

#check
data_w7_parent %>% count(score)
#looks good.
```

**No NAs!**

``` {r}
data_w7_parent <- data_w7_parent %>% 
  pivot_wider(names_from = item, values_from = score) %>% 
  drop_na(Q1:Q25) %>% 
  pivot_longer(Q1:Q25, names_to = "item", values_to = "score")
```

### Self-Report (CM)

**Draw items**

``` {r}
#self-report
data_w7_CM <- data_w7 %>% 
  select(MCSID, CM_w7_SDQ_01:CM_w7_SDQ_25) %>% 
  mutate(Q1 = CM_w7_SDQ_01,
         Q2 = CM_w7_SDQ_02,
         Q3 = CM_w7_SDQ_03,
         Q4 = CM_w7_SDQ_04,
         Q5 = CM_w7_SDQ_05,
         Q6 = CM_w7_SDQ_06,
         Q7 = CM_w7_SDQ_07,
         Q8 = CM_w7_SDQ_08,
         Q9 = CM_w7_SDQ_09,
         Q10 = CM_w7_SDQ_10,
         Q11 = CM_w7_SDQ_11,
         Q12 = CM_w7_SDQ_12,
         Q13 = CM_w7_SDQ_13,
         Q14 = CM_w7_SDQ_14,
         Q15 = CM_w7_SDQ_15,
         Q16 = CM_w7_SDQ_16,
         Q17 = CM_w7_SDQ_17,
         Q18 = CM_w7_SDQ_18,
         Q19 = CM_w7_SDQ_19,
         Q20 = CM_w7_SDQ_20,
         Q21 = CM_w7_SDQ_21,
         Q22 = CM_w7_SDQ_22,
         Q23 = CM_w7_SDQ_23,
         Q24 = CM_w7_SDQ_24,
         Q25 = CM_w7_SDQ_25,
         report = "self") %>%
  pivot_longer(c(Q1:Q25), names_to = "item", values_to = "score") %>%
  select(MCSID, item, score, report)
```

**Recoding**

I need to check the values of the SDQ run from 0 to 2 like the how the SDQ works.

``` {r}
#view data
data_w7_CM %>% count(score)

#scores consist of -1, 1, 2, 3. I assume 1 corresponds to 0, 2 corresponds to 1, 3 corresponds to 2, -1 corresponds to missing and -9 corresponds to dont know or refusal.

#make -9 and -1 into NAs
data_w7_CM <- data_w7_CM %>%
  mutate(score = na_if(score, "-9")) %>%
  mutate(score = na_if(score, "-1"))

#check
data_w7_CM %>% count(score)

#now make 1, 2, 3, into 0, 1, 2.
data_w7_CM <- data_w7_CM %>%
  mutate(score = recode(score,
                        "1" = 0,
                        "2" = 1,
                        "3" = 2))

#check
data_w7_CM %>% count(score)
#looks good.
```

**No NAs!**

``` {r}
data_w7_CM <- data_w7_CM %>% 
  pivot_wider(names_from = item, values_from = score) %>% 
  drop_na(Q1:Q25) %>% 
  pivot_longer(Q1:Q25, names_to = "item", values_to = "score")
```

**Final Data for Wave 7**

Now combine this to main dataframe for wave 7.

``` {r}
#join them
w7_parent_CM <- bind_rows(data_w7_parent, data_w7_CM)

#join to main dataframe
data_w7_final <- data_w7 %>% 
  inner_join(w7_parent_CM, by = "MCSID")
```

## Clean up dataframes we don't need

```{r}
rm(data)
rm(data_ASD_combined)
rm(data_ASD_final)
rm(data_ASD3)
rm(data_ASD4)
rm(data_ASD5)
rm(data_ASD6)
rm(data_eth)
rm(data_sex)
rm(data_sex_combined)
rm(data_sex_final)
rm(data_sex3)
rm(data_w5)
rm(data_w5_parent)
rm(data_w5_teacher)
rm(data_w7)
rm(data_w7_CM)
rm(data_w7_parent)
rm(MCS)
rm(w5_parent_teacher)
rm(w7_parent_CM)
```

# Descriptive Statistics

## Wave 5

### Parent report

**Overall ASD**

``` {r}
#create wide format
data_w5_desc_p <- data_w5_final %>%
  filter(report == "parent") %>%
  pivot_wider(names_from = item, values_from = c(score))
```

Report ASD diagnoses

``` {r}
#table
data_w5_desc_p %>% count(ASD_final) %>% mutate(prop = n/sum(n))

#graph
#count data, no need for graph
```

**Sex and ASD**

``` {r}
#Sex only
#table
data_w5_desc_p %>% count(sex_final) %>% mutate(prop = n/sum(n))

#Sex and ASD
#table
data_w5_desc_p %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w5_desc_p %>% filter(ASD_final == "ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#non-ASD
data_w5_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#graph
data_w5_desc_p %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = sex_final)) + geom_bar(stat = "identity", position = "dodge")
```

**Ethnicity and ASD**

``` {r}
#Ethnicity only
#table
data_w5_desc_p %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#Ethnicity and ASD
#table
data_w5_desc_p %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w5_desc_p %>% filter(ASD_final == "ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#non-ASD
data_w5_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#graph
data_w5_desc_p %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w5_desc_p %>% filter(ASD_final == "ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w5_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")
```

**Overall SDQ**

We need to first calculate subscale scores, and total difficulty score.

The items load onto the factors as follows
Emotional problems scale: Items 3, 8, 13, 16, 24
Conduct problems scale: Items 5, 7, 12, 18, 22
Hyperactivity scale: Items 2, 10, 15, 21, 25
Peer problems scale: Items 6, 11, 14, 19, 23
Prosocial scale: Items 1, 4, 9, 17, 20

``` {r}
data_w5_desc_p <- data_w5_desc_p %>% 
  mutate(emotional = Q3 + Q8 + Q13 + Q16 + Q24, 
         conduct = Q5 + Q7 + Q12 + Q18 + Q22, 
         hyperactivity = Q2 + Q10 + Q15 + Q21 + Q25, 
         peer = Q6 + Q11 + Q14 + Q19 + Q23, 
         prosocial = Q1 + Q4 + Q9 + Q17 + Q20, 
         difficulty = emotional + conduct + hyperactivity + peer)
```

``` {r}
#table
data_w5_desc_p %>% summarise(mean_diff = mean(difficulty), 
                             sd_diff = sd(difficulty), 
                             min_diff = min(difficulty), 
                             max_diff = max(difficulty), 
                             mean_pro = mean(prosocial), 
                             sd_pro = sd(prosocial), 
                             min_pro = min(prosocial), 
                             max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_p %>% ggplot(aes(x = difficulty)) + geom_histogram() #slight positive skew / right skew

#prosocial
data_w5_desc_p %>% ggplot(aes(x = prosocial)) + geom_histogram() #negative skew / left skew
```

**SDQ by sex**

``` {r}
#table
data_w5_desc_p %>% 
  group_by(sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_p %>% ggplot(aes(x = difficulty, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew

data_w5_desc_p %>% ggplot(aes(x = sex_final, y = difficulty, fill = sex_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "Sex", y = "Total Difficulty Scores") + theme_classic()
ggsave("w5 parent SDQ difficulty split by sex.jpg")

#prosocial
data_w5_desc_p %>% ggplot(aes(x = prosocial, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD**

``` {r}
#table
data_w5_desc_p %>% 
  group_by(ASD_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_p %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w5_desc_p %>% ggplot(aes(x = ASD_final, y = difficulty, fill = ASD_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores") + theme_classic()
ggsave("w5 parent SDQ difficulty split by ASD.jpg")

#prosocial
data_w5_desc_p %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD and Sex**

``` {r}
#table
data_w5_desc_p %>% 
  group_by(ASD_final, sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_p %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w5_desc_p %>% ggplot(aes(x = ASD_final, y = difficulty, fill = sex_final)) + geom_violin(alpha = .7, width = .9) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5, position = position_dodge(width = .9)) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores", fill = "Sex") + theme_classic()
ggsave("w5 parent SDQ difficulty split by ASD and sex.jpg")

#prosocial
data_w5_desc_p %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

### Teacher report

**Overall ASD**

``` {r}
#create wide format
data_w5_desc_t <- data_w5_final %>%
  filter(report == "teacher") %>%
  pivot_wider(names_from = item, values_from = c(score))
```

Report ASD diagnoses

``` {r}
#table
data_w5_desc_t %>% count(ASD_final) %>% mutate(prop = n/sum(n))

#graph
#count data, no need for graph
```

**Sex and ASD**

``` {r}
#Sex only
#table
data_w5_desc_t %>% count(sex_final) %>% mutate(prop = n/sum(n))

#Sex and ASD
#table
data_w5_desc_t %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w5_desc_t %>% filter(ASD_final == "ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#non-ASD
data_w5_desc_t %>% filter(ASD_final == "Non-ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#graph
data_w5_desc_t %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = sex_final)) + geom_bar(stat = "identity", position = "dodge")
```

**Ethnicity and ASD**

``` {r}
#Ethnicity only
#table
data_w5_desc_t %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#Ethnicity and ASD
#table
data_w5_desc_t %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w5_desc_t %>% filter(ASD_final == "ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#non-ASD
data_w5_desc_t %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#graph
data_w5_desc_t %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w5_desc_t %>% filter(ASD_final == "ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w5_desc_t %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")
```

**Overall SDQ**

We need to first calculate subscale scores, and total difficulty score.

The items load onto the factors as follows
Emotional problems scale: Items 3, 8, 13, 16, 24
Conduct problems scale: Items 5, 7, 12, 18, 22
Hyperactivity scale: Items 2, 10, 15, 21, 25
Peer problems scale: Items 6, 11, 14, 19, 23
Prosocial scale: Items 1, 4, 9, 17, 20

``` {r}
data_w5_desc_t <- data_w5_desc_t %>% 
  mutate(emotional = Q3 + Q8 + Q13 + Q16 + Q24, 
         conduct = Q5 + Q7 + Q12 + Q18 + Q22, 
         hyperactivity = Q2 + Q10 + Q15 + Q21 + Q25, 
         peer = Q6 + Q11 + Q14 + Q19 + Q23, 
         prosocial = Q1 + Q4 + Q9 + Q17 + Q20, 
         difficulty = emotional + conduct + hyperactivity + peer)
```

``` {r}
#table
data_w5_desc_t %>% summarise(mean_diff = mean(difficulty), 
                             sd_diff = sd(difficulty), 
                             min_diff = min(difficulty), 
                             max_diff = max(difficulty), 
                             mean_pro = mean(prosocial), 
                             sd_pro = sd(prosocial), 
                             min_pro = min(prosocial), 
                             max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_t %>% ggplot(aes(x = difficulty)) + geom_histogram() #slight positive skew / right skew

#prosocial
data_w5_desc_t %>% ggplot(aes(x = prosocial)) + geom_histogram() #negative skew / left skew
```

**SDQ by sex**

``` {r}
#table
data_w5_desc_t %>% 
  group_by(sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_t %>% ggplot(aes(x = difficulty, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew

data_w5_desc_t %>% ggplot(aes(x = sex_final, y = difficulty, fill = sex_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "Sex", y = "Total Difficulty Scores") + theme_classic()
ggsave("w5 teacher SDQ difficulty split by sex.jpg")

#prosocial
data_w5_desc_t %>% ggplot(aes(x = prosocial, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD**

``` {r}
#table
data_w5_desc_t %>% 
  group_by(ASD_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_t %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w5_desc_t %>% ggplot(aes(x = ASD_final, y = difficulty, fill = ASD_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores") + theme_classic()
ggsave("w5 teacher SDQ difficulty split by ASD.jpg")

#prosocial
data_w5_desc_t %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD and Sex**

``` {r}
#table
data_w5_desc_t %>% 
  group_by(ASD_final, sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w5_desc_t %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w5_desc_t %>% ggplot(aes(x = ASD_final, y = difficulty, fill = sex_final)) + geom_violin(alpha = .7, width = .9) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5, position = position_dodge(width = .9)) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores", fill = "Sex") + theme_classic()
ggsave("w5 teacher SDQ difficulty split by ASD and sex.jpg")

#prosocial
data_w5_desc_t %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

``` {r}
rm(data_w5_desc_p)
rm(data_w5_desc_t)
```

## Wave 7

### Parent report

**Overall ASD**

``` {r}
#create wide format
data_w7_desc_p <- data_w7_final %>%
  filter(report == "parent") %>%
  pivot_wider(names_from = item, values_from = c(score))
```

Report ASD diagnoses

``` {r}
#table
data_w7_desc_p %>% count(ASD_final) %>% mutate(prop = n/sum(n))

#graph
#count data, no need for graph
```

**Sex and ASD**

``` {r}
#Sex only
#table
data_w7_desc_p %>% count(sex_final) %>% mutate(prop = n/sum(n))

#Sex and ASD
#table
data_w7_desc_p %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w7_desc_p %>% filter(ASD_final == "ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#non-ASD
data_w7_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#graph
data_w7_desc_p %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = sex_final)) + geom_bar(stat = "identity", position = "dodge")
```

**Ethnicity and ASD**

``` {r}
#Ethnicity only
#table
data_w7_desc_p %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#Ethnicity and ASD
#table
data_w7_desc_p %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w7_desc_p %>% filter(ASD_final == "ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#non-ASD
data_w7_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#graph
data_w7_desc_p %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w7_desc_p %>% filter(ASD_final == "ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w7_desc_p %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")
```

**Overall SDQ**

We need to first calculate subscale scores, and total difficulty score.

The items load onto the factors as follows
Emotional problems scale: Items 3, 8, 13, 16, 24
Conduct problems scale: Items 5, 7, 12, 18, 22
Hyperactivity scale: Items 2, 10, 15, 21, 25
Peer problems scale: Items 6, 11, 14, 19, 23
Prosocial scale: Items 1, 4, 9, 17, 20

``` {r}
data_w7_desc_p <- data_w7_desc_p %>% 
  mutate(emotional = Q3 + Q8 + Q13 + Q16 + Q24, 
         conduct = Q5 + Q7 + Q12 + Q18 + Q22, 
         hyperactivity = Q2 + Q10 + Q15 + Q21 + Q25, 
         peer = Q6 + Q11 + Q14 + Q19 + Q23, 
         prosocial = Q1 + Q4 + Q9 + Q17 + Q20, 
         difficulty = emotional + conduct + hyperactivity + peer)
```

``` {r}
#table
data_w7_desc_p %>% summarise(mean_diff = mean(difficulty), 
                             sd_diff = sd(difficulty), 
                             min_diff = min(difficulty), 
                             max_diff = max(difficulty), 
                             mean_pro = mean(prosocial), 
                             sd_pro = sd(prosocial), 
                             min_pro = min(prosocial), 
                             max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_p %>% ggplot(aes(x = difficulty)) + geom_histogram() #slight positive skew / right skew

#prosocial
data_w7_desc_p %>% ggplot(aes(x = prosocial)) + geom_histogram() #negative skew / left skew
```

**SDQ by sex**

``` {r}
#table
data_w7_desc_p %>% 
  group_by(sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_p %>% ggplot(aes(x = difficulty, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew

data_w7_desc_p %>% ggplot(aes(x = sex_final, y = difficulty, fill = sex_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "Sex", y = "Total Difficulty Scores") + theme_classic()
ggsave("w7 parent SDQ difficulty split by sex.jpg")

#prosocial
data_w7_desc_p %>% ggplot(aes(x = prosocial, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD**

``` {r}
#table
data_w7_desc_p %>% 
  group_by(ASD_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_p %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w7_desc_p %>% ggplot(aes(x = ASD_final, y = difficulty, fill = ASD_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores") + theme_classic()
ggsave("w7 parent SDQ difficulty split by ASD.jpg")

#prosocial
data_w7_desc_p %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD and Sex**

``` {r}
#table
data_w7_desc_p %>% 
  group_by(ASD_final, sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_p %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w7_desc_p %>% ggplot(aes(x = ASD_final, y = difficulty, fill = sex_final)) + geom_violin(alpha = .7, width = .9) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5, position = position_dodge(width = .9)) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores", fill = "Sex") + theme_classic()
ggsave("w7 parent SDQ difficulty split by ASD and sex.jpg")

#prosocial
data_w7_desc_p %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

### Self-report

**Overall ASD**

``` {r}
#create wide format
data_w7_desc_cm <- data_w7_final %>%
  filter(report == "self") %>%
  pivot_wider(names_from = item, values_from = c(score))
```

Report ASD diagnoses

``` {r}
#table
data_w7_desc_cm %>% count(ASD_final) %>% mutate(prop = n/sum(n))

#graph
#count data, no need for graph
```

**Sex and ASD**

``` {r}
#Sex only
#table
data_w7_desc_cm %>% count(sex_final) %>% mutate(prop = n/sum(n))

#Sex and ASD
#table
data_w7_desc_cm %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w7_desc_cm %>% filter(ASD_final == "ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#non-ASD
data_w7_desc_cm %>% filter(ASD_final == "Non-ASD") %>% count(sex_final) %>% mutate(prop = n/sum(n))

#graph
data_w7_desc_cm %>% count(sex_final, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = sex_final)) + geom_bar(stat = "identity", position = "dodge")
```

**Ethnicity and ASD**

``` {r}
#Ethnicity only
#table
data_w7_desc_cm %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#Ethnicity and ASD
#table
data_w7_desc_cm %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n))

#ASD
data_w7_desc_cm %>% filter(ASD_final == "ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#non-ASD
data_w7_desc_cm %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity) %>% mutate(prop = n/sum(n))

#graph
data_w7_desc_cm %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ASD_final, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w7_desc_cm %>% filter(ASD_final == "ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")

data_w7_desc_cm %>% filter(ASD_final == "Non-ASD") %>% count(ethnicity, ASD_final) %>% mutate(prop = n/sum(n)) %>% ggplot(aes(x = ethnicity, y = n, fill = ethnicity)) + geom_bar(stat = "identity", position = "dodge")
```

**Overall SDQ**

We need to first calculate subscale scores, and total difficulty score.

The items load onto the factors as follows
Emotional problems scale: Items 3, 8, 13, 16, 24
Conduct problems scale: Items 5, 7, 12, 18, 22
Hyperactivity scale: Items 2, 10, 15, 21, 25
Peer problems scale: Items 6, 11, 14, 19, 23
Prosocial scale: Items 1, 4, 9, 17, 20

``` {r}
data_w7_desc_cm <- data_w7_desc_cm %>% 
  mutate(emotional = Q3 + Q8 + Q13 + Q16 + Q24, 
         conduct = Q5 + Q7 + Q12 + Q18 + Q22, 
         hyperactivity = Q2 + Q10 + Q15 + Q21 + Q25, 
         peer = Q6 + Q11 + Q14 + Q19 + Q23, 
         prosocial = Q1 + Q4 + Q9 + Q17 + Q20, 
         difficulty = emotional + conduct + hyperactivity + peer)
```

``` {r}
#table
data_w7_desc_cm %>% summarise(mean_diff = mean(difficulty), 
                             sd_diff = sd(difficulty), 
                             min_diff = min(difficulty), 
                             max_diff = max(difficulty), 
                             mean_pro = mean(prosocial), 
                             sd_pro = sd(prosocial), 
                             min_pro = min(prosocial), 
                             max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_cm %>% ggplot(aes(x = difficulty)) + geom_histogram() #slight positive skew / right skew

#prosocial
data_w7_desc_cm %>% ggplot(aes(x = prosocial)) + geom_histogram() #negative skew / left skew
```

**SDQ by sex**

``` {r}
#table
data_w7_desc_cm %>% 
  group_by(sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_cm %>% ggplot(aes(x = difficulty, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew

data_w7_desc_cm %>% ggplot(aes(x = sex_final, y = difficulty, fill = sex_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "Sex", y = "Total Difficulty Scores") + theme_classic()
ggsave("w7 self SDQ difficulty split by sex.jpg")

#prosocial
data_w7_desc_cm %>% ggplot(aes(x = prosocial, fill = sex_final)) + geom_histogram() + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD**

``` {r}
#table
data_w7_desc_cm %>% 
  group_by(ASD_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_cm %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w7_desc_cm %>% ggplot(aes(x = ASD_final, y = difficulty, fill = ASD_final)) + geom_jitter(size = .3, shape = 4) + geom_violin(alpha = .7) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores") + theme_classic()
ggsave("w7 self SDQ difficulty split by ASD.jpg")

#prosocial
data_w7_desc_cm %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_histogram() + facet_wrap(~ASD_final, scales = "free") #negative skew / left skew
```

**SDQ by ASD and Sex**

``` {r}
#table
data_w7_desc_cm %>% 
  group_by(ASD_final, sex_final) %>% summarise(n = n(),
                                    mean_diff = mean(difficulty), 
                                    sd_diff = sd(difficulty), 
                                    min_diff = min(difficulty), 
                                    max_diff = max(difficulty), 
                                    mean_pro = mean(prosocial), 
                                    sd_pro = sd(prosocial), 
                                    min_pro = min(prosocial), 
                                    max_pro = max(prosocial))

#graph
#difficulty
data_w7_desc_cm %>% ggplot(aes(x = difficulty, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #slight positive skew / right skew for non-ASD. ASD group normal distribution

data_w7_desc_cm %>% ggplot(aes(x = ASD_final, y = difficulty, fill = sex_final)) + geom_violin(alpha = .7, width = .9) + stat_summary(fun = mean, geom = "point", shape = 20, size = 5, position = position_dodge(width = .9)) + labs(x = "ASD Diagnosis", y = "Total Difficulty Scores", fill = "Sex") + theme_classic()
ggsave("w7 self SDQ difficulty split by ASD and sex.jpg")

#prosocial
data_w7_desc_cm %>% ggplot(aes(x = prosocial, fill = ASD_final)) + geom_density(alpha = .7) + facet_wrap(~sex_final, scales = "free") #negative skew / left skew
```

``` {r}
rm(data_w7_desc_p)
rm(data_w7_desc_cm)
```

## Wave 5 and 7

``` {r}
#create wide format
w57_w5 <- data_w5_final %>% select(MCSID, item, score, report, ASD_final, sex_final) %>% mutate(wave = "wave_5")
w57_w7 <- data_w7_final %>% select(MCSID, item, score, report, ASD_final, sex_final) %>% mutate(wave = "wave_7")
w57 <- bind_rows(w57_w5, w57_w7)
rm(w57_w5)
rm(w57_w7)

w57 <- w57 %>%
  pivot_wider(names_from = item, values_from = score)
```

# Measurement Invariance

The items load onto the factors as follows
Emotional problems scale: Items 3, 8, 13, 16, 24
Conduct problems scale: Items 5, 7, 12, 18, 22
Hyperactivity scale: Items 2, 10, 15, 21, 25
Peer problems scale: Items 6, 11, 14, 19, 23
Prosocial scale: Items 1, 4, 9, 17, 20

## Wave 5 (Non-ASD)

Need to create "short" format

```{r}
w5_measurement_td <- data_w5_final %>%
  filter(ASD_final == "Non-ASD") %>%
  pivot_wider(names_from = item, values_from = score)
```

### Factor structure

``` {r}
SDQ <- "
emotional =~ Q3 + Q8 + Q13 + Q16 + Q24
conduct =~ Q5 + Q7 + Q12 + Q18 + Q22
hyperactivity =~ Q2 + Q10 + Q15 + Q21 + Q25
peer =~ Q6 + Q11 + Q14 + Q19 + Q23
prosocial =~ Q1 + Q4 + Q9 + Q17 + Q20
"

base_w5_td <- cfa(SDQ, data = w5_measurement_td, std.lv = TRUE, meanstructure = TRUE)
summary(base_w5_td, rsquare = T, standardized = T, fit.measures = T)

#Plot
semPaths(object = base_w5_td, #model object
         what = 'est', #est gives thicknesses and numbers, 'std' gives standardized values
         fixedStyle = 1, #other numbers gives dotted line for fixed params
         sizeMan = 4, #observed variable text size
         intercepts = F,
         residuals = T,
         exoCov = F,
         sizeLat = 6, #latent variable text size
         edge.label.cex = 0.5, #size of numbers
         posCol = "dark green",
         negCol = "red",
         nCharNodes = 0,#controls label length (0=full name, 2=abrev to 2 chars)
         layout='tree2', #note we had to change this to make the layout
         edge.width = 1,
         filetype = "jpg",
         filename = "SDQ_model",
         height = 2.5,
         optimizeLatRes = T,
         fade = F,
         edge.label.position = c(.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5),
         rotation=1) #moves boxes around

#c(.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.3,.4,.5,.6,.7,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5),
```

### Configural Invariance

```{r}
con_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", std.lv=TRUE)
summary(con_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Metric Invariance

```{r}
met_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", group.equal = "loadings", std.lv=TRUE)
summary(met_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Scalar Invariance

```{r}
sca_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", group.equal = c("intercepts", "loadings"), std.lv=TRUE)
summary(sca_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict Invariance

```{r}
stri_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals"), std.lv=TRUE)
summary(stri_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict + Equal Factor Means

```{r}
strim_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means"), std.lv=TRUE)
summary(strim_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strucutral Invariance 

**Add latent variable variances and covariances**

```{r}
stru_inv_w5_td <- cfa(SDQ, data = w5_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means", "lv.variances", "lv.covariances"), std.lv=TRUE)
summary(stru_inv_w5_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Comparisons

```{r}
comp_fit <- compareFit(base_w5_td, con_inv_w5_td, met_inv_w5_td, sca_inv_w5_td, stri_inv_w5_td, strim_inv_w5_td, stru_inv_w5_td)
summary(comp_fit,  fit.measures = c("cfi", "rmsea", "srmr"))
```

## Wave 5 (ASD)

Need to create "short" format

```{r}
w5_measurement_asd <- data_w5_final %>%
  filter(ASD_final == "ASD") %>%
  pivot_wider(names_from = item, values_from = score)
```

### Factor structure

``` {r}
SDQ <- "
emotional =~ Q3 + Q8 + Q13 + Q16 + Q24
conduct =~ Q5 + Q7 + Q12 + Q18 + Q22
hyperactivity =~ Q2 + Q10 + Q15 + Q21 + Q25
peer =~ Q6 + Q11 + Q14 + Q19 + Q23
prosocial =~ Q1 + Q4 + Q9 + Q17 + Q20
"

base_w5_asd <- cfa(SDQ, data = w5_measurement_asd, std.lv = TRUE, meanstructure = TRUE)
summary(base_w5_asd, rsquare = T, standardized = T, fit.measures = T)
```

### Configural Invariance

```{r}
con_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", std.lv=TRUE)
summary(con_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Metric Invariance

```{r}
met_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", group.equal = "loadings", std.lv=TRUE)
summary(met_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Scalar Invariance

```{r}
sca_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", group.equal = c("intercepts", "loadings"), std.lv=TRUE)
summary(sca_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict Invariance

```{r}
stri_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals"), std.lv=TRUE)
summary(stri_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict + Equal Factor Means

```{r}
strim_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means"), std.lv=TRUE)
summary(strim_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strucutral Invariance 

**Add latent variable variances and covariances**

```{r}
stru_inv_w5_asd <- cfa(SDQ, data = w5_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means", "lv.variances", "lv.covariances"), std.lv=TRUE)
summary(stru_inv_w5_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Comparisons

```{r}
comp_fit <- compareFit(base_w5_asd, con_inv_w5_asd, met_inv_w5_asd, sca_inv_w5_asd, stri_inv_w5_asd, strim_inv_w5_asd, stru_inv_w5_asd)
summary(comp_fit,  fit.measures = c("cfi", "rmsea", "srmr"))
```

## Wave 7 (Non-ASD)

Need to create "short" format

```{r}
w7_measurement_td <- data_w7_final %>%
  filter(ASD_final == "Non-ASD") %>%
  pivot_wider(names_from = item, values_from = score)
```

### Factor structure

``` {r}
SDQ <- "
emotional =~ Q3 + Q8 + Q13 + Q16 + Q24
conduct =~ Q5 + Q7 + Q12 + Q18 + Q22
hyperactivity =~ Q2 + Q10 + Q15 + Q21 + Q25
peer =~ Q6 + Q11 + Q14 + Q19 + Q23
prosocial =~ Q1 + Q4 + Q9 + Q17 + Q20
"

base_w7_td <- cfa(SDQ, data = w7_measurement_td, std.lv = TRUE, meanstructure = TRUE)
summary(base_w7_td, rsquare = T, standardized = T, fit.measures = T)
```

### Configural Invariance

```{r}
con_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", std.lv=TRUE)
summary(con_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Metric Invariance

```{r}
met_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", group.equal = "loadings", std.lv=TRUE)
summary(met_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Scalar Invariance

```{r}
sca_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", group.equal = c("intercepts", "loadings"), std.lv=TRUE)
summary(sca_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict Invariance

```{r}
stri_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals"), std.lv=TRUE)
summary(stri_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict + Equal Factor Means

```{r}
strim_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means"), std.lv=TRUE)
summary(strim_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strucutral Invariance 

**Add latent variable variances and covariances**

```{r}
stru_inv_w7_td <- cfa(SDQ, data = w7_measurement_td, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means", "lv.variances", "lv.covariances"), std.lv=TRUE)
summary(stru_inv_w7_td, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Comparisons

```{r}
comp_fit <- compareFit(base_w7_td, con_inv_w7_td, met_inv_w7_td, sca_inv_w7_td, stri_inv_w7_td, strim_inv_w7_td, stru_inv_w7_td)
summary(comp_fit,  fit.measures = c("cfi", "rmsea", "srmr"))
```

## Wave 7 (ASD)

Need to create "short" format

```{r}
w7_measurement_asd <- data_w7_final %>%
  filter(ASD_final == "ASD") %>%
  pivot_wider(names_from = item, values_from = score)
```

### Factor structure

``` {r}
SDQ <- "
emotional =~ Q3 + Q8 + Q13 + Q16 + Q24
conduct =~ Q5 + Q7 + Q12 + Q18 + Q22
hyperactivity =~ Q2 + Q10 + Q15 + Q21 + Q25
peer =~ Q6 + Q11 + Q14 + Q19 + Q23
prosocial =~ Q1 + Q4 + Q9 + Q17 + Q20
"

base_w7_asd <- cfa(SDQ, data = w7_measurement_asd, std.lv = TRUE, meanstructure = TRUE)
summary(base_w7_asd, rsquare = T, standardized = T, fit.measures = T)
```

### Configural Invariance

```{r}
con_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", std.lv=TRUE)
summary(con_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Metric Invariance

```{r}
met_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", group.equal = "loadings", std.lv=TRUE)
summary(met_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Scalar Invariance

```{r}
sca_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", group.equal = c("intercepts", "loadings"), std.lv=TRUE)
summary(sca_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict Invariance

```{r}
stri_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals"), std.lv=TRUE)
summary(stri_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strict + Equal Factor Means

```{r}
strim_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means"), std.lv=TRUE)
summary(strim_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Strucutral Invariance 

**Add latent variable variances and covariances**

```{r}
stru_inv_w7_asd <- cfa(SDQ, data = w7_measurement_asd, group = "report", group.equal = c("intercepts", "loadings", "residuals", "means", "lv.variances", "lv.covariances"), std.lv=TRUE)
summary(stru_inv_w7_asd, rsquare = T, fit.measures=TRUE, standardized=TRUE)
```

### Comparisons

```{r}
comp_fit <- compareFit(base_w7_asd, con_inv_w7_asd, met_inv_w7_asd, sca_inv_w7_asd, stri_inv_w7_asd, strim_inv_w7_asd, stru_inv_w7_asd)
summary(comp_fit,  fit.measures = c("cfi", "rmsea", "srmr"))
```
